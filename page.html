<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>세종시 노인보호구역</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    body {
      font-family: 'Noto Sans', sans-serif;
      margin: 0;
      padding: 0;
    }

    #map {
      height: 100vh;
      margin: 0;
    }

    .side-bar-wrapper {
      position: fixed;
      top: 60px;
      left: -250px;
      width: 250px;
      height: 100vh;
      background-color: white;
      overflow-y: auto;
      transition: left 0.5s ease;
      z-index: 999;
    }

    .side-bar-wrapper ul {
      list-style-type: none;
      margin: 0;
      padding: 20px 10px;
    }

    .side-bar-wrapper ul > li {
      margin-bottom: 10px;
    }

    .side-bar-wrapper ul > li > a {
      color: black;
      text-decoration: none;
      display: block;
      padding: 15px;
      border-radius: 8px;
    }

    .side-bar-wrapper ul > li > a:hover {
      background-color: #555;
      color: white;
    }

    .toggle-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background-color: white;
      color: black;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      cursor: pointer;
      z-index: 1000;
    }

    /* 네비게이션 바 스타일 추가 */
    .nav-bar {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .nav-bar a {
      text-decoration: none;
      color: #333;
      margin: 0 10px;
      padding: 5px 10px;
      border-radius: 3px;
    }

    .nav-bar a:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <!-- 네비게이션 바 추가 -->
  <div class="nav-bar">
    <a href="{{ url_for('home') }}">
    <a href="{{ url_for('search') }}">
    <a href="{{ url_for('roadview') }}">
  </div>

  <!-- 사이드바 -->
  <div id="sideBar" class="side-bar-wrapper">
    <ul>
      <li><a href="#" onclick="scrollToSection('map')">지도 보기</a></li>
      <li><a href="index.html">메인으로</a></li>
      <li><a href="search.html">검색</a></li>
      <li>
        <h5 style="color: black; margin-left: 10px;">레이어 선택</h5>
        <button id="children-zone-btn" class="btn btn-primary" style="margin: 5px;">어린이 보호구역</button>
        <button id="elderly-zone-btn" class="btn btn-success" style="margin: 5px;">노인 보호구역</button>
        <button id="optimal-zone-btn" class="btn btn-danger" style="margin: 5px;">최적지 선정 구역</button>
      </li>
    </ul>
  </div>

  <!-- 토글 버튼 -->
  <button class="toggle-btn" id="toggleBtn">&#9776; 메뉴</button>

  <!-- 지도 -->
  <div id="map"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script>
    // 지도 초기화
    const map = L.map('map').setView([36.50972725, 127.2591418], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
    }).addTo(map);

    // zones 데이터 정의
    const zones = [
        { 
            name: "Zone 1", 
            lat: 36.528872, 
            lon: 127.367796, 
            address: "세종시 고운동", 
            population: 1200, 
            accidents: 3 
        },
        {
            name: "Zone 2", 
            lat: 36.464646, 
            lon: 127.280006, 
            address: "세종시 아름동", 
            population: 800, 
            accidents: 5 
        },
        { 
            name: "Zone 3", 
            lat: 36.679749, 
            lon: 127.205951, 
            address: "세종시 반곡동", 
            population: 950, 
            accidents: 2 
        },
        { 
            name: "Zone 4", 
            lat: 36.562973, 
            lon: 127.283338, 
            address: "세종시 도담동", 
            population: 1100, 
            accidents: 4 
        },
        { 
            name: "Zone 5", 
            lat: 36.722422, 
            lon: 127.157880, 
            address: "세종시 소담동", 
            population: 650, 
            accidents: 1 
        }
    ];

    // 사이드바 토글 기능
    document.getElementById('toggleBtn').addEventListener('click', () => {
      const sideBar = document.getElementById('sideBar');
      const leftPosition = sideBar.style.left === '0px' ? '-250px' : '0px';
      sideBar.style.left = leftPosition;
    });

    // 검색 버튼 컨트롤
    const SearchButtonControl = L.Control.extend({
      options: {
        position: 'topright'
      },
      onAdd: function () {
        const container = L.DomUtil.create('button', 'leaflet-bar leaflet-control leaflet-control-custom');
        container.innerHTML = '<i class="bi bi-search"></i>';
        container.title = "검색하기";
        container.style.backgroundColor = 'white';
        container.style.width = '40px';
        container.style.height = '40px';
        container.style.cursor = 'pointer';

        container.onclick = function () {
          window.location.href = 'search.html';
        };

        return container;
      },
    });

    // 로드뷰 버튼 컨트롤
    const RoadviewButtonControl = L.Control.extend({
      options: {
        position: 'topright'
      },
      onAdd: function () {
        const container = L.DomUtil.create('button', 'leaflet-bar leaflet-control leaflet-control-custom');
        container.innerHTML = '<i class="bi bi-eye"></i>';
        container.title = "로드뷰 보기";
        container.style.backgroundColor = 'white';
        container.style.width = '40px';
        container.style.height = '40px';
        container.style.cursor = 'pointer';

        container.onclick = function () {
          window.location.href = 'roadview_search.html';
        };

        return container;
      },
    });

    
   // 레이어  버튼 커스텀 컨트롤 생성
    const LayerButtonControl = L.Control.extend({
      options: {
        position: 'topright', // 버튼 위치 (좌측 상단)
      },
      onAdd: function () {
        // 버튼 생성
        const container = L.DomUtil.create('button', 'leaflet-bar leaflet-control leaflet-control-custom');
        container.innerHTML = '<i class="bi bi-layers"></i>'; // 아이콘 (Bootstrap 사용)
        container.title = "레이어변경";
        container.style.backgroundColor = 'lightyellow';
        container.style.width = '40px';
        container.style.height = '40px';
        container.style.cursor = 'pointer';

        // 버튼 클릭 이벤트 추가
        container.onclick = function () {
           window.location.href = 'traffic.html';
         };

        return container;
      },
    });

    // 버튼 추가
    map.addControl(new SearchButtonControl());
    map.addControl(new RoadviewButtonControl());
    map.addControl(new LayerButtonControl());

    // 버튼 동작 정의
    const actions = [
      {
        text: '<i class="bi bi-info-circle"></i>',
        color: 'lightblue',
        callback: () => alert('노인보호구역 정보를 확인하세요.'),
      },
      {
        text: '<i class="bi bi-map"></i>',
        color: 'lightgreen',
        callback: () => map.setView([36.50972725, 127.2591418], 13),
      },
      {
        text: '<i class="bi bi-geo-alt"></i>',
        color: 'lightpink',
        callback: () => map.locate({ setView: true, maxZoom: 15 }),
      }
    ];

    // 추가 버튼 컨트롤 생성
    const CustomButtonControl = L.Control.extend({
      options: {
        position: 'topright'
      },
      initialize: function (text, color, callback) {
        this.text = text;
        this.color = color;
        this.callback = callback;
      },
      onAdd: function () {
        const container = L.DomUtil.create('button', 'leaflet-bar leaflet-control leaflet-control-custom');
        container.innerHTML = this.text;
        container.style.backgroundColor = this.color;
        container.style.border = 'none';
        container.style.width = '40px';
        container.style.height = '40px';
        container.style.cursor = 'pointer';

        L.DomEvent.on(container, 'click', this.callback);
        return container;
      },
    });

    // 버튼 추가
    actions.forEach(action => {
      map.addControl(new CustomButtonControl(action.text, action.color, action.callback));
    });

    // 모든 위치에 마커 생성
    const markers = zones.map(zone => {
        const marker = L.marker([zone.lat, zone.lon], {
            icon: L.icon({
                iconUrl: 'https://cdn-icons-png.flaticon.com/512/854/854866.png',
                iconSize: [30, 30],
            })
        }).addTo(map)
        .bindPopup(`
            <b>${zone.name}</b><br>
            주소: ${zone.address}<br>
            노인 인구: ${zone.population}명<br>
            사고 건수: ${zone.accidents}건<br>
            <a href="roadview_search.html">로드뷰 보기</a>
        `);

        // 각 위치에 서클 표시
        L.circle([zone.lat, zone.lon], {
            color: 'blue',
            fillColor: 'rgba(0, 0, 255, 0.3)',
            fillOpacity: 0.2,
            radius: 300,
        }).addTo(map);

        return marker;
    });

    function handleLayerClick(layerId) {
      // 기존 레이어 및 마커 제거
      map.eachLayer(layer => {
        if (layer.options && layer.options.customLayer) {
          map.removeLayer(layer);
        }
      });

      // 새로운 레이어 추가
      zones.forEach(zone => {
        const color = layerId === 'children-zone-btn' ? 'lightblue' : 
                     layerId === 'elderly-zone-btn' ? 'orange' : 'pink';
                     
        L.circle([zone.lat, zone.lon], {
            color: color,
            fillColor: color,
            fillOpacity: 0.2,
            radius: 300,
            customLayer: true
        }).addTo(map);
      });
    }

    // 레이어 버튼 이벤트 리스너 추가
    document.getElementById('children-zone-btn').addEventListener('click', () => handleLayerClick('children-zone-btn'));
    document.getElementById('elderly-zone-btn').addEventListener('click', () => handleLayerClick('elderly-zone-btn'));
    document.getElementById('optimal-zone-btn').addEventListener('click', () => handleLayerClick('optimal-zone-btn'));

  </script>
</body>
</html>
